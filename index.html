<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Build Nesting or Hierarchical Structures • nestr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Build Nesting or Hierarchical Structures">
<meta property="og:description" content="Facilitates building a nesting or hierarchical structure as a list or data frame by using a human friendly syntax. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">nestr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="nestr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#nestr" class="anchor"></a>nestr</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">nestr</span><span class="op">)</span></code></pre></div>
<p>The main purpose of <code>nestr</code> R-package is to build nested (or hierarchical) structures with output as a list or a data frame. The syntax is particularly useful when the child units are unbalanced across the parental levels.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/nest_in.html">nest_in</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, <span class="co"># parental vector</span>
        <span class="fl">2</span> <span class="op">~</span> <span class="fl">3</span>, <span class="co"># level 2 has 3 children</span>
        <span class="va">.</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># the remaining levels have 1 child </span>
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] "1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c</span>
<span class="co">#&gt; [1] "1" "2" "3"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] "1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $b</span>
<span class="co">#&gt; [1] "1"</span></code></pre></div>
<p>The parental vector may be a factor with different ordering of the levels.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/nest_in.html">nest_in</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># parental vector</span>
        <span class="fl">2</span> <span class="op">~</span> <span class="fl">3</span>, <span class="co"># level 2 has 3 children</span>
        <span class="va">.</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># the remaining levels have 1 child </span>
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] "1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c</span>
<span class="co">#&gt; [1] "1" "2" "3"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] "1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $b</span>
<span class="co">#&gt; [1] "1"</span></code></pre></div>
<p>Or you can refer the parental level by character.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/nest_in.html">nest_in</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, <span class="co"># parental vector</span>
        <span class="st">"b"</span> <span class="op">~</span> <span class="fl">3</span>, <span class="co"># "b" has 3 children</span>
        <span class="va">.</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># the remaining levels have 1 child </span>
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] "1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $c</span>
<span class="co">#&gt; [1] "1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $a</span>
<span class="co">#&gt; [1] "1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $b</span>
<span class="co">#&gt; [1] "1" "2" "3"</span></code></pre></div>
<p>A more interesting example.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/nest_in.html">nest_in</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Math"</span>, <span class="st">"Science"</span>, <span class="st">"Economics"</span>, <span class="st">"Art"</span><span class="op">)</span>, 
               <span class="st">"Science"</span> <span class="op">~</span> <span class="fl">2</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Art"</span>, <span class="st">"Math"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">10</span>,
                    <span class="va">.</span> <span class="op">~</span> <span class="fl">3</span>,
        prefix <span class="op">=</span> <span class="st">"student-"</span>,
        leading0 <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; $Math</span>
<span class="co">#&gt;  [1] "student-0001" "student-0002" "student-0003" "student-0004" "student-0005"</span>
<span class="co">#&gt;  [6] "student-0006" "student-0007" "student-0008" "student-0009" "student-0010"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Science</span>
<span class="co">#&gt; [1] "student-0001" "student-0002"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Economics</span>
<span class="co">#&gt; [1] "student-0001" "student-0002" "student-0003"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Art</span>
<span class="co">#&gt;  [1] "student-0001" "student-0002" "student-0003" "student-0004" "student-0005"</span>
<span class="co">#&gt;  [6] "student-0006" "student-0007" "student-0008" "student-0009" "student-0010"</span></code></pre></div>
<div id="edibblenested_in-and-nestrnest_in" class="section level2">
<h2 class="hasAnchor">
<a href="#edibblenested_in-and-nestrnest_in" class="anchor"></a><code>edibble::nested_in</code> and <code>nestr::nest_in</code>
</h2>
<p>The syntax of <code>nestr</code> is similar to <code>edibble::nested_in</code> which is used within the <a href="https://edibble.emitanaka.org/reference/set_units.html"><code>edibble::set_units</code></a> to construct nested (or hierarchical) structures.</p>
<p>Unlike <code>edibble::nested_in</code>, the <code><a href="reference/nest_in.html">nestr::nest_in</a></code> returns a data frame. You may also notice that the name of the function is different although both share virtually the same syntax. One way to remember the differences in function name is that <code>nested_in</code> is for <code>edibble</code> and is meant for construction of the experimental design (notice the “ed” in the function name). When the verb is written in present tense (i.e. <code>nest_in</code>), it’s part of <code>nestr</code> and your focus is to create a structure in the present.</p>
</div>
<div id="amplify" class="section level2">
<h2 class="hasAnchor">
<a href="#amplify" class="anchor"></a><code>amplify</code>
</h2>
<p>The <code>dplyr::mutate</code> function modifies, creates or deletes columns but doesn’t alter the number of rows. The <code><a href="reference/amplify.html">nestr::amplify</a></code> function can create new columns which generally increase (or amplify) the size of the row dimension. The columns that were amplified as a result of the created column will be duplicated. If you are familiar with gene replication process then you can recall these functions in those terms. An amplified gene is just a duplication of the original. A mutated gene modifies the original state.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AU"</span>, <span class="st">"NZ"</span>, <span class="st">"JPN"</span>, <span class="st">"CHN"</span>, <span class="st">"USA"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="reference/amplify.html">amplify</a></span><span class="op">(</span>soil <span class="op">=</span> <span class="fu"><a href="reference/nest_in.html">nest_in</a></span><span class="op">(</span><span class="va">country</span>, 
                            <span class="st">"AU"</span> <span class="op">~</span> <span class="fl">10</span>,
                            <span class="st">"NZ"</span> <span class="op">~</span> <span class="fl">8</span>,
                               <span class="va">.</span> <span class="op">~</span> <span class="fl">5</span>,
                           prefix <span class="op">=</span> <span class="st">"sample"</span>,
                           leading0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
          rep <span class="op">=</span> <span class="fu"><a href="reference/nest_in.html">nest_in</a></span><span class="op">(</span><span class="va">soil</span>, 
                          <span class="fl">1</span><span class="op">:</span><span class="fl">3</span> <span class="op">~</span> <span class="fl">3</span>, <span class="co"># first 3 samples have 3 technical rep</span>
                            <span class="va">.</span> <span class="op">~</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># remaining have two rep</span>

<span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 81 x 3</span>
<span class="co">#&gt;    country soil     rep  </span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;</span>
<span class="co">#&gt;  1 AU      sample01 1    </span>
<span class="co">#&gt;  2 AU      sample01 2    </span>
<span class="co">#&gt;  3 AU      sample01 3    </span>
<span class="co">#&gt;  4 NZ      sample01 1    </span>
<span class="co">#&gt;  5 NZ      sample01 2    </span>
<span class="co">#&gt;  6 NZ      sample01 3    </span>
<span class="co">#&gt;  7 CHN     sample01 1    </span>
<span class="co">#&gt;  8 CHN     sample01 2    </span>
<span class="co">#&gt;  9 CHN     sample01 3    </span>
<span class="co">#&gt; 10 USA     sample01 1    </span>
<span class="co">#&gt; # … with 71 more rows</span></code></pre></div>
</div>
<div id="tidyverse" class="section level2">
<h2 class="hasAnchor">
<a href="#tidyverse" class="anchor"></a><code>tidyverse</code>
</h2>
<p>For those who want to stay within the tidyverse framework, this is in fact doable just using <code>dplyr</code> and <code>tidyr</code>.</p>
<p>The semantics are less direct, however and chaining of nesting structure is cumbersome. For example, see the equivalent example from before below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tidyr</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AU"</span>, <span class="st">"NZ"</span>, <span class="st">"JPN"</span>, <span class="st">"CHN"</span>, <span class="st">"USA"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>soil <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">country</span><span class="op">==</span><span class="st">"AU"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"sample%.2d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>,
                          <span class="va">country</span><span class="op">==</span><span class="st">"NZ"</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"sample%.2d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>,
                               <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"sample%.2d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_longer</span><span class="op">(</span><span class="va">soil</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>rep <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">soil</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sample01"</span>, <span class="st">"sample02"</span>, <span class="st">"sample03"</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,
                           <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest_longer</span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 81 x 3</span>
<span class="co">#&gt;    country soil       rep</span>
<span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt;</span>
<span class="co">#&gt;  1 AU      sample01     1</span>
<span class="co">#&gt;  2 AU      sample01     2</span>
<span class="co">#&gt;  3 AU      sample01     3</span>
<span class="co">#&gt;  4 AU      sample02     1</span>
<span class="co">#&gt;  5 AU      sample02     2</span>
<span class="co">#&gt;  6 AU      sample02     3</span>
<span class="co">#&gt;  7 AU      sample03     1</span>
<span class="co">#&gt;  8 AU      sample03     2</span>
<span class="co">#&gt;  9 AU      sample03     3</span>
<span class="co">#&gt; 10 AU      sample04     1</span>
<span class="co">#&gt; # … with 71 more rows</span></code></pre></div>
<p>The intent I think is more clear from the above <code>amplify</code> example. It’s a personal preference so use what suits your own situation!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Emi Tanaka <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-1455-259X" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Emi Tanaka.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
